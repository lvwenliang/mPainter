/*!
mPainter v0.0.4 
Author: Mark Zhou 
Date: 2013-08-12 
License: MIT 
*/
!function(a,b){"use strict";function c(a){var b=q._internal.points.push(a);b>2&&0===b%2&&h()}function d(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}function e(){for(var a=q._internal.points,b="M"+a[0].x+","+a[0].y+" Q",c=a.length,d=1;c-1>d;d++)b+=a[d].x+","+a[d].y+" ";return b+="T"+a[c-1].x+","+a[c-1].y}function f(){q._internal.is_mousedown=!1,q._internal.points=[];var a=o(q.options.element_prefix+q._internal.element_index);a.setAttribute("opacity",q._internal.opacity),q._internal.element_index++}function g(a){return a===b?q._internal.points[q._internal.points.length-1]:q._internal.points[a]}function h(){switch(q._internal.tool){case"PAINT":i();break;case"LINE":j()}}function i(){var a=q.options.element_prefix+q._internal.element_index,b=o(a);b?b.setAttribute("d",e()):(b=d("path",{id:a,d:e(),fill:"none",stroke:q._internal.color,"stroke-linecap":"round","stroke-width":2*q._internal.painter_radius,opacity:q._internal.opacity/2}),q._internal.el.appendChild(b))}function j(){var a=q.options.element_prefix+q._internal.element_index,b=o(a);if(b){var c=g();b.setAttribute("x2",c.x),b.setAttribute("y2",c.y)}else{var e=g(0),f=g();b=d("line",{id:a,x1:e.x,y1:e.y,x2:f.x,y2:f.y,"stroke-linecap":"round","stroke-width":2*q._internal.painter_radius,stroke:q._internal.color,opacity:q._internal.opacity/2}),q._internal.el.appendChild(b)}}function k(a){var b=d("circle",{id:q.options.cursor_id,cx:a.offsetX,cy:a.offsetY,r:q._internal.painter_radius,stroke:q._internal.color,fill:q._internal.color});q._internal.el.appendChild(b)}function l(a){var b=o(q.options.cursor_id);b.setAttribute("cx",a.offsetX),b.setAttribute("cy",a.offsetY)}function m(){var a=o(q.options.cursor_id);a&&a.parentNode.removeChild(a)}function n(a){return{x:a.offsetX,y:a.offsetY}}function o(a){return document.getElementById(a)}function p(a){q.options.debug===!0&&console.log(a)}var q,r=a.mPainter||{};r=function(a){q=this,this._init(a)},r.prototype={_init:function(a){var b={debug:!1,id:"mysvg",cursor_id:"cursor",element_prefix:"element_"};this.options=$.extend({},b,a),this._internal={el:o(this.options.id),tool:"PAINT",element_index:0,is_mousedown:!1,points:[],painter_radius:3,opacity:1,color:"#FF0000"},this._initMouseEvents()},_initMouseEvents:function(){$(document).on("mousedown","#"+this.options.id,function(a){p("Mouse down: "+a.offsetX+","+a.offsetY),a.originalEvent.preventDefault(),c(n(a)),q._internal.is_mousedown=!0}),$(document).on("mousemove","#"+this.options.id,function(a){q._internal.is_mousedown===!0&&(p("Mouse move to: "+a.offsetX+","+a.offsetY),c(n(a))),l(a)}),$(document).on("mouseup","#"+this.options.id,function(a){q._internal.is_mousedown===!0&&(p("Mouse up: "+a.offsetX+","+a.offsetY),c(n(a)),f())}),$(document).on("mouseenter","#"+this.options.id,function(a){p("Mouse enter",a),k(a)}),$(document).on("mouseout","#"+this.options.id,function(a){var b=a.toElement?a.toElement:a.relatedTarget;(null===b||"svg"!==b.nodeName&&"svg"!==b.parentNode.nodeName&&b.id!==q.options.cursor_id)&&(q._internal.is_mousedown===!0&&(p("Mouse out: "+a.offsetX+","+a.offsetY),f()),m())})},setColor:function(a){this._internal.color=a},setPainterSize:function(a){this._internal.painter_radius=a},setOpacity:function(a){this._internal.opacity=a},setTool:function(a){this._internal.tool=a},reset:function(){this._internal.points=[],this._internal.element_index=0,this._internal.is_mousedown=!1;for(var a=this._internal.el;a.lastChild;)a.removeChild(a.lastChild)}},a.mPainter=r}(window);