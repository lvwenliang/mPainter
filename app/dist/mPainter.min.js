/*!
mPainter v0.0.5 
Author: Mark Zhou 
Date: 2013-08-13 
License: MIT 
*/
!function(a,b){"use strict";function c(a){var b=s._internal.points.push(a);b>2&&0===b%2&&h()}function d(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}function e(){for(var a=s._internal.points,b="M"+a[0].x+","+a[0].y+" Q",c=a.length,d=1;c-1>d;d++)b+=a[d].x+","+a[d].y+" ";return b+="T"+a[c-1].x+","+a[c-1].y}function f(){s._internal.is_mousedown=!1,s._internal.points=[];var a=o(s.options.element_prefix+s._internal.element_index);a&&a.setAttribute("opacity",s._internal.opacity),s._internal.element_index++}function g(a){return a===b?s._internal.points[s._internal.points.length-1]:s._internal.points[a]}function h(){switch(s._internal.tool){case"PAINT":i();break;case"LINE":j()}}function i(){var a=s.options.element_prefix+s._internal.element_index,b=o(a);b?b.setAttribute("d",e()):(b=d("path",{id:a,d:e(),fill:"none",stroke:s._internal.color,"stroke-linecap":"round","stroke-width":2*s._internal.painter_radius,opacity:s._internal.opacity/2}),s._internal.el.appendChild(b))}function j(){var a=s.options.element_prefix+s._internal.element_index,b=o(a);if(b){var c=g();b.setAttribute("x2",c.x),b.setAttribute("y2",c.y)}else{var e=g(0),f=g();b=d("line",{id:a,x1:e.x,y1:e.y,x2:f.x,y2:f.y,"stroke-linecap":"round","stroke-width":2*s._internal.painter_radius,stroke:s._internal.color,opacity:s._internal.opacity/2}),s._internal.el.appendChild(b)}}function k(a){var b=d("circle",{id:s.options.cursor_id,cx:a.offsetX,cy:a.offsetY,r:s._internal.painter_radius,stroke:s._internal.color,fill:s._internal.color});s._internal.el.appendChild(b)}function l(a){var b=o(s.options.cursor_id);b.setAttribute("cx",a.offsetX),b.setAttribute("cy",a.offsetY)}function m(){var a=o(s.options.cursor_id);a&&a.parentNode.removeChild(a)}function n(a){return{x:a.offsetX,y:a.offsetY}}function o(a){return document.getElementById(a)}function p(){for(var a={},b=0,c=arguments.length;c>b;b++)for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&(a[d]=arguments[b][d]);return a}function q(a,b){for(var c=a.relatedTarget||a.toElement||a.fromElement;c&&c!==b;)c=c.parentNode;return c!==b?!0:!1}function r(a){s.options.debug===!0&&console.log(a)}var s,t=a.mPainter||{};t=function(a){s=this,this._init(a)},t.prototype={_init:function(a){var b={debug:!1,id:"mysvg",cursor_id:"cursor",element_prefix:"element_"};this.options=p({},b,a),this._internal={el:o(this.options.id),tool:"PAINT",element_index:0,is_mousedown:!1,points:[],painter_radius:3,opacity:1,color:"#FF0000"},this._initMouseEvents()},_initMouseEvents:function(){o(this.options.id).addEventListener("mousedown",function(a){r("Mouse down: "+a.offsetX+","+a.offsetY),a.preventDefault(),c(n(a)),s._internal.is_mousedown=!0}),o(this.options.id).addEventListener("mousemove",function(a){s._internal.is_mousedown===!0&&(r("Mouse move to: "+a.offsetX+","+a.offsetY),c(n(a))),l(a)}),o(this.options.id).addEventListener("mouseup",function(a){s._internal.is_mousedown===!0&&(r("Mouse up: "+a.offsetX+","+a.offsetY),c(n(a)),f())}),o(this.options.id).addEventListener("mouseover",function(a){q(a,this)&&(r("Mouse enter",a),k(a))},!1),o(this.options.id).addEventListener("mouseout",function(a){var b=a.toElement?a.toElement:a.relatedTarget;(null===b||"svg"!==b.nodeName&&"svg"!==b.parentNode.nodeName&&b.id!==s.options.cursor_id)&&(s._internal.is_mousedown===!0&&(r("Mouse out: "+a.offsetX+","+a.offsetY),f()),m())})},setColor:function(a){this._internal.color=a},setPainterSize:function(a){this._internal.painter_radius=a},setOpacity:function(a){this._internal.opacity=a},setTool:function(a){this._internal.tool=a},reset:function(){this._internal.points=[],this._internal.element_index=0,this._internal.is_mousedown=!1;for(var a=this._internal.el;a.lastChild;)a.removeChild(a.lastChild)}},a.mPainter=t}(window);