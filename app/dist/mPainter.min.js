/*!
mPainter v0.0.1 
Author: Mark Zhou 
Date: 2013-08-11 
License: MIT 
*/
!function(a){"use strict";function b(a){var b=k._internal.points.push(a);b>2&&0===b%2&&c()}function c(){var a=k.options.element_prefix+k._internal.element_index,b=document.getElementById(a);b?b.setAttribute("d",d()):(b=e("path",{id:a,d:d(),fill:"none",stroke:k._internal.color,"stroke-width":2*k._internal.painter_radius,"stroke-linecap":"round"}),k._internal.el.appendChild(b))}function d(){for(var a=k._internal.points,b="M"+a[0].x+","+a[0].y+" Q",c=a.length,d=1;c-1>d;d++)b+=a[d].x+","+a[d].y+" ";return b+="T"+a[c-1].x+","+a[c-1].y}function e(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c}function f(a){var b=e("circle",{id:k.options.cursor_id,cx:a.offsetX,cy:a.offsetY,r:k._internal.painter_radius,stroke:k._internal.color,fill:k._internal.color});k._internal.el.appendChild(b)}function g(a){var b=document.getElementById(k.options.cursor_id);b.setAttribute("cx",a.offsetX),b.setAttribute("cy",a.offsetY)}function h(){var a=document.getElementById(k.options.cursor_id);a&&a.parentNode.removeChild(a)}function i(a){return{x:a.offsetX,y:a.offsetY}}function j(a){k.options.debug===!0&&console.log(a)}var k,l=a.mPainter||{};l=function(a){this._init(a),k=this},l.prototype={_init:function(a){var b={debug:!1,id:"mysvg",cursor_id:"cursor",element_prefix:"element_"};this.options=$.extend({},b,a),this._internal={el:document.getElementById(this.options.id),tool:"paint",is_mousedown:!1,points:[],element_index:0,painter_radius:5,color:"blue"},this._initMouseEvents()},_initMouseEvents:function(){$(document).on("mousedown","#"+this.options.id,function(a){j("Mouse down: "+a.offsetX+","+a.offsetY),a.originalEvent.preventDefault(),b(i(a)),k._internal.is_mousedown=!0}),$(document).on("mousemove","#"+this.options.id,function(a){k._internal.is_mousedown===!0&&(j("Mouse move to: "+a.offsetX+","+a.offsetY),b(i(a))),g(a)}),$(document).on("mouseup","#"+this.options.id,function(a){if(k._internal.is_mousedown===!0){j("Mouse up: "+a.offsetX+","+a.offsetY);var c=i(a);b(c),k._clear(),k._internal.element_index++}}),$(document).on("mouseenter","#"+this.options.id,function(a){j("Mouse enter",a),f(a)}),$(document).on("mouseout","#"+this.options.id,function(a){var b=a.toElement?a.toElement:a.relatedTarget;(null===b||"svg"!==b.nodeName&&"svg"!==b.parentNode.nodeName&&b.id!==k.options.cursor_id)&&(j("Mouse out: "+a.offsetX+","+a.offsetY),k._clear(),k._internal.element_index++,h())})},_clear:function(){this._internal.is_mousedown=!1,this._internal.points=[]},setColor:function(a){this._internal.color=a},reset:function(){this._internal.points=[],this._internal.element_index=0,this._internal.is_mousedown=!1;for(var a=this._internal_el;a.lastChild;)a.remove(a.lastChild)}},a.mPainter=l}(window);